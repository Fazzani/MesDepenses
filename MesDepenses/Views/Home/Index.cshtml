@{
    ViewBag.Title = "Home Page";
}
@section scripts {
    <script>
        var OperationVM = function (montant,libelle, datevaleur,reference,compte) {
            this.Montant = ko.observable(montant);
            this.Libelle = ko.observable(libelle);
            this.Datevaleur = ko.observable(datevaleur);
            this.Reference = ko.observable(reference);
            this.Compte = ko.observable(compte);
            this.$type = 'OperationVM';
           // ko.mapping.fromJS(data, mapping, this);
        };

        var urlGetData = '@Url.Action("ReadData", "Home")';
        var ViewModel = function () {
            var self = this;

            self.items = ko.observableArray();

            self.compteLength = ko.computed(function () {
                return self.items().length;
            }, this);
            self.headShow = ko.computed(function () {
                return self.ite
            }, this);
            self.groupBy = function () {
                var tmp = _.groupBy(self.items(), function (item) {
                    return item.Montant().length;
                });
                self.items(tmp);
            };

            self.sortBy = function () {
                self.items(_.sortBy(self.items(), function (item) { return parseInt(item.Montant()); }));
            };

            self.load = function () {
                $.getJSON(urlGetData, function (data) {
                    //console.log(JSON.parse(data));
                    var mappedData = ko.utils.arrayMap(JSON.parse(data), function (item) {
                        return new OperationVM(item.Montant, item.Libelle, item.Datevaleur, item.Reference, item.Compte);
                    });
                    self.items(mappedData);

                });
            };
            self.load();
        };
        $(function () {
            ko.applyBindings(new ViewModel());

        });
    </script>

    @*<script src="~/Scripts/Custom/ViewModel/IndexVM.js"></script>*@

}

@section featured {
    <section class="featured">
        <div class="content-wrapper">
            <hgroup class="title">
                <h1>@ViewBag.Title.</h1>
                <h2>@ViewBag.Message</h2>
            </hgroup>
            <p>
            </p>
        </div>
    </section>
}
<h3>Mes Opérations</h3>

<div class="table-responsive">
    <table class="table table-striped table-hover table-condensed">
        <thead>
            <tr>
                <th>Libellé
                </th>
                <th>Date
                </th>
                <th>Référence
                </th>
                <th>Montant
                </th>
            </tr>
        </thead>
        <tbody data-bind="foreach: items">
            <tr data-bind="css: { 'warning': Montant() < 0, 'success': Montant() > 0, 'danger': Montant() <= -1000 }">
                <td data-bind="text: Libelle"></td>
                <td data-bind="text: Datevaleur"></td>
                <td data-bind="text: Reference"></td>
                <td data-bind="text: Montant"></td>
            </tr>
        </tbody>
    </table>
</div>
<div class="actions">
    <input type="button" value="group by" data-bind="click: groupBy" />
    <input type="button" value="sort by" data-bind="click: sortBy" />
</div>
